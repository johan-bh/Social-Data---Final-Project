<!DOCTYPE html>
<html>
<head>
    <title>Interactive Business Location Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/select2/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2/dist/js/select2.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        #map { height: 98vh; width: 100%;}
        body {
        overflow: hidden; /* Hide scrollbars */
        }
        
        #map-container {
            position: relative;
            width: 100%;
            height: 100vh; /* Full viewport height */
        }
        .select2-container--default .select2-selection--multiple {
        border: 1px solid #ccc;
        cursor: pointer;
        outline: none;
    }

    </style>
</head>
<body>
    <div id="map-container">
        <div id="map"></div>

        <!-- Top-right controls for slider and dropdowns -->
        <div id="top-right-controls" style="position: absolute; top: 10px; left: 50px; width: 340px; background: rgba(244, 244, 244, 0.9); padding: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 1000;">
            <div>
                <input type="range" min="2006" max="2021" value="2021" class="slider" id="yearSlider">
                <p>Year: <span id="sliderValue">2020</p>
            </div>
            <div>
                <!-- {"ROBBERY": 0, "POSSESSION OF STOLEN PROPERTY": 1, "PETIT LARCENY": 2, "CRIMINAL MISCHIEF & RELATED OF": 3, "BURGLARY": 4, "CRIMINAL TRESPASS": 5, 
                    "GRAND LARCENY": 6, "GRAND LARCENY OF MOTOR VEHICLE": 7, "OFFENSES INVOLVING FRAUD": 8} -->
                <label for="crimeSelector">Select Crime:</label>
                <select id="crimeSelector" multiple="multiple">
                    <option value="0">ROBBERY</option>
                    <option value="1">POSSESSION OF STOLEN PROPERTY</option>
                    <option value="2">PETIT LARCENY</option>
                    <option value="3">CRIMINAL MISCHIEF & RELATED OF</option>
                    <option value="4">BURGLARY</option>
                    <option value="5">CRIMINAL TRESPASS</option>
                    <option value="6">GRAND LARCENY</option>
                    <option value="7">GRAND LARCENY OF MOTOR VEHICLE</option>
                    <option value="8">OFFENSES INVOLVING FRAUD</option>
                </select>
                
                
            </div>
        </div>
    </div>
    
<script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
<script>

$(document).ready(function() {
    $('#crimeSelector').select2({
        placeholder: "Select crimes",
        allowClear: true,
        width: '100%',
        dropdownAutoWidth: true

    }).on('change', function() {
        updateHeatmapFromInputs();
    });

    var map = L.map('map').setView([40.748817, -73.985428], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    var heatLayer = L.heatLayer([], {
        radius: 5,
        blur: 5,
        maxZoom: 18,
        max: 1.0 // This can be adjusted based on the data density and visual requirements
    }).addTo(map);

    // Define locations for the markers
    landmark_coordinates = [
    [40.748817, -73.985428], 
    [40.689247, -74.044502], 
    [40.752726, -73.977229], 
    [40.706086, -73.996864], 
    [40.785091, -73.968285]  
    ];


    // Loop through the locations and create a marker for each one
    locations.forEach(function(location, index) {
        L.marker(location, {
            draggable: 'true'  // Enables the marker to be dragged
        }).addTo(map).bindPopup('Business Location ' + (index + 1));
    });

    function updateHeatmap(year, crimeTypes) {
        fetch('data_usecase2.json')
            .then(response => response.json())
            .then(data => {
                var filteredData = data.filter(d => d.Year === year && crimeTypes.includes(d.crime_id));
                var heatData = filteredData.map(d => [d.lat, d.lon, 1]);
                heatLayer.setLatLngs(heatData);
            })
            .then(() => {
                console.log('Heatmap updated with year:', year, 'and crime types:', crimeTypes);
            })
            .catch(error => console.error('Error loading the data:', error));
    }

    function updateHeatmapFromInputs() {
        var year = parseInt(yearSlider.value);
        var selectedOptions = Array.from(crimeSelector.selectedOptions).map(option => parseInt(option.value));
        updateHeatmap(year, selectedOptions);
    }

    yearSlider.oninput = function() {
        document.getElementById('sliderValue').textContent = this.value;
        updateHeatmapFromInputs();
    };

    updateHeatmapFromInputs();
});


</script>
</body>
</html>